[custom]
#================================================
# 1. 全局标志
#================================================
udp_flag=true
tfo_flag=true

#================================================
# 2. 基础策略组 (用于分流规则)
#================================================
custom_proxy_group=🎯 直连`select`[]DIRECT
custom_proxy_group=⛔ 拦截`select`[]REJECT

#================================================
# 3. 末端节点组 (Level 3 - 按出口ISP)
#    (CORRECTED: 必须使用 url-test/fallback 进行筛选)
#    (CORRECTED: 使用 \\ 双重转义，并移除多余括号)
#================================================

# --- 🇭🇰 香港 ---
custom_proxy_group=🇭🇰 BGP`url-test`(.*\\\[BGP-B1\\\]HKG.*|.*\\\[BGP-B2\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 HKBN`url-test`(.*\\\[HKBN\\\]HKG.*|.*\\\[HKBN-E\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 HKT`url-test`(.*\\\[HKT\\\]HKG.*|.*\\\[HKT-G\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 SMT`url-test`(.*\\\[SMT\\\]HKG.*|.*\\\[SMT-5G\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 HGC`url-test`(.*\\\[HGC\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 CMHK`url-test`(.*\\\[CMHK-5G\\\]HKG.*|.*\\\[CMHK\\\]HKG.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇭🇰 iCable`url-test`(.*\\\[iCable\\\]HKG.*)`http://www.gstatic.com/generate_204`300

# --- 🇺🇸 美国 ---
custom_proxy_group=🇺🇸 ATT`url-test`(.*\\\[ATT-R\\\]LAX.*|.*\\\[ATT-V\\\]NYC.*|.*\\\[ATT-B\\\]USA.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇺🇸 COX`url-test`(.*\\\[COX-S\\\]LAX.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇺🇸 BGP`url-test`(.*\\\[BGP-M\\\]LAX.*|.*\\\[BGP-B2\\\]LAX.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇺🇸 Charter`url-test`(.*\\\[Charter\\\]USA.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇺🇸 Xfinity`url-test`(.*\\\[Xfinity-5G\\\]USA.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇺🇸 Fortex`url-test`(.*\\\[Fortex\\\]USA.*)`http://www.gstatic.com/generate_204`300

# --- 🇸🇬 新加坡 ---
custom_proxy_group=🇸🇬 BGP`url-test`(.*\\\[BGP-B1\\\]SGP.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇸🇬 MyRepublic`url-test`(.*\\\[MyRepublic\\\]SGP.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇸🇬 SingTel`url-test`(.*\\\[SingTel\\\]SGP.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇸🇬 M1`url-test`(.*\\\[M1\\\]SGP.*)`http://www.gstatic.com/generate_204`300

# --- 🇯🇵 日本 ---
custom_proxy_group=🇯🇵 SoNet`url-test`(.*\\\[SoNet\\\]TYO.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇯🇵 SoftBank`url-test`(.*\\\[SB\\\]TYO.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇯🇵 BIGLOBE`url-test`(.*\\\[BIGLOBE\\\]TYO.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇯🇵 Asahi`url-test`(.*\\\[Asahi\\\]TYO.*)`http://www.gstatic.com/generate_204`300

# --- 🇨🇳 台湾 ---
custom_proxy_group=🇨🇳 HiNet`url-test`(.*\\\[HiNet\\\]TPE.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇨🇳 Kbro`url-test`(.*\\\[Kbro\\\]TPE.*)`http://www.gstatic.com/generate_204`300
custom_proxy_group=🇨🇳 SeedNet`url-test`(.*\\\[SeedNet\\\]TPE.*)`http://www.gstatic.com/generate_204`300

# --- 🇩🇪 德国 ---
custom_proxy_group=🇩🇪 BGP`url-test`(.*\\\[BGP-M\\\]FRA.*|.*\\\[BGP-B1\\\]FRA.*)`http://www.gstatic.com/generate_204`300

# --- 🇬🇧 英国 ---
custom_proxy_group=🇬🇧 BGP`url-test`(.*\\\[BGP-B1\\\]GBP.*)`http://www.gstatic.com/generate_204`300

# --- 🇳🇱 荷兰 ---
custom_proxy_group=🇳🇱 BGP`url-test`(.*\\\[BGP-Q\\\]AMS.*)`http://www.gstatic.com/generate_204`300

# --- 🇲🇴 澳门 ---
custom_proxy_group=🇲🇴 CTM`url-test`(.*\\\[CTM\\\]MAC.*)`http://www.gstatic.com/generate_204`300

# --- 🇲🇾 马来西亚 ---
custom_proxy_group=🇲🇾 TMNet`url-test`(.*\\\[TMNet\\\]KUL.*)`http://www.gstatic.com/generate_204`300

# --- 🇹🇭 泰国 ---
custom_proxy_group=🇹🇭 TRUE`url-test`(.*\\\[TRUE\\\]BKK.*)`http://www.gstatic.com/generate_204`300

# --- 🇮🇩 印尼 ---
custom_proxy_group=🇮🇩 PT`url-test`(.*\\\[PT\\\]IDN.*)`http://www.gstatic.com/generate_204`300


#================================================
# 4. 国家策略组 (Level 2 - 按国家/地区)
#    (类型：select，包含 L3 组)
#================================================

# --- 主力地区 ---
custom_proxy_group=🇭🇰 HKG`select`[]🇭🇰 BGP`[]🇭🇰 HKBN`[]🇭🇰 HKT`[]🇭🇰 SMT`[]🇭🇰 HGC`[]🇭🇰 CMHK`[]🇭🇰 iCable
custom_proxy_group=🇺🇸 USA`select`[]🇺🇸 ATT`[]🇺🇸 COX`[]🇺🇸 BGP`[]🇺🇸 Charter`[]🇺🇸 Xfinity`[]🇺🇸 Fortex
custom_proxy_group=🇸🇬 SGP`select`[]🇸🇬 BGP`[]🇸🇬 MyRepublic`[]🇸🇬 SingTel`[]🇸🇬 M1
custom_proxy_group=🇯🇵 JPN`select`[]🇯🇵 SoNet`[]🇯🇵 SoftBank`[]🇯🇵 BIGLOBE`[]🇯🇵 Asahi
custom_proxy_group=🇨🇳 台湾`select`[]🇨🇳 HiNet`[]🇨🇳 Kbro`[]🇨🇳 SeedNet
custom_proxy_group=🇩🇪 DEU`select`[]🇩🇪 BGP

# --- 其他地区 (打包) ---
custom_proxy_group=🇬🇧 GBR`select`[]🇬🇧 BGP
custom_proxy_group=🇳🇱 NLD`select`[]🇳🇱 BGP
custom_proxy_group=🇲🇴 MAC`select`[]🇲🇴 CTM
custom_proxy_group=🇲🇾 MYS`select`[]🇲🇾 TMNet
custom_proxy_group=🇹🇭 THA`select`[]🇹🇭 TRUE
custom_proxy_group=🇮🇩 IDN`select`[]🇮🇩 PT

custom_proxy_group=🍱 其他地区`select`[]🇬🇧 GBR`[]🇳🇱 NLD`[]🇲🇴 MAC`[]🇲🇾 MYS`[]🇹🇭 THA`[]🇮🇩 IDN


#================================================
# 5. 顶层功能策略组 (Level 1 - 按功能)
#    (类型：select，包含 L2 组)
#================================================
custom_proxy_group=🏃 Proxies`select`[]🇭🇰 HKG`[]🇺🇸 USA`[]🇨🇳 台湾`[]🇯🇵 JPN`[]🇸🇬 SGP`[]🇩🇪 DEU`[]🍱 其他地区
custom_proxy_group=🎥 Media`select`[]🇭🇰 HKG`[]🇺🇸 USA`[]🇨🇳 台湾`[]🇯🇵 JPN`[]🇸🇬 SGP`[]🇩🇪 DEU`[]🍱 其他地区
custom_proxy_group=🤖 AI`select`[]🇭🇰 HKG`[]🇺🇸 USA`[]🇨🇳 台湾`[]🇯🇵 JPN`[]🇸🇬 SGP`[]🇩🇪 DEU`[]🍱 其他地区
custom_proxy_group=💳 PayPal`select`[]🇭🇰 HKG`[]🇺🇸 USA`[]🇨🇳 台湾`[]🇯🇵 JPN`[]🇸🇬 SGP`[]🇩🇪 DEU`[]🍱 其他地区
custom_proxy_group=📲 Telegram`select`[]🇭🇰 HKG`[]🇺🇸 USA`[]🇨🇳 台湾`[]🇯🇵 JPN`[]🇸🇬 SGP`[]🇩🇪 DEU`[]🍱 其他地区


#================================================
# 6. 分流规则
#================================================
enable_rule_generator=true
overwrite_original_rules=true

# blacklist
ruleset=⛔ 拦截,https://ruleset.skk.moe/List/non_ip/sogouinput.conf

# non-ip
# internal
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/lan.conf

# apple microsoft china
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/apple_cdn.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/microsoft_cdn.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/apple_cn.conf

# apple microsoft not china
ruleset=🏃 Proxies,https://ruleset.skk.moe/List/non_ip/apple_services.conf
ruleset=🏃 Proxies,https://ruleset.skk.moe/List/non_ip/microsoft.conf

# netease music
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/neteasemusic.conf

# domestic
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/domestic.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/non_ip/direct.conf

# Media
ruleset=🎥 Media,https://ruleset.skk.moe/List/non_ip/stream.conf

# Paypal
ruleset=💳 PayPal,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/PayPal/PayPal.list

# AI
ruleset=🤖 AI,https://ruleset.skk.moe/List/non_ip/ai.conf

# overseas
ruleset=🏃 Proxies,https://ruleset.skk.moe/List/non_ip/global.conf

# ip
ruleset=🎯 直连,https://ruleset.skk.moe/List/ip/lan.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/ip/neteasemusic.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/ip/domestic.conf
ruleset=🎯 直连,https://ruleset.skk.moe/List/ip/china_ip.conf
ruleset=🎥 Media,https://ruleset.skk.moe/List/ip/stream.conf

# telegram
ruleset=📲 Telegram,https://ruleset.skk.moe/List/ip/telegram.conf

# FINAL (匹配所有剩余流量)
ruleset=🏃 Proxies,[]MATCH


#================================================
# 7. 其他设置 (Clash 模板参数)
#================================================
append_sub_userinfo=true
clash_use_new_field_name=true

[template]
clash.mixed_port=7890
clash.redir_port=7891
clash.allow_lan=true
clash.log_level=info
clash.api_port=0.0.0.0:9090
clash.tcp_fast_open=true


#================================================
# 8. 用户信息 (不变)
#================================================
[userinfo]
stream_rule=^剩余流量：(.*?)\|总流量：(.*)$|total=$2&left=$1
stream_rule=^剩余流量：(.*?) (.*)$|total=$1&left=$2
stream_rule=^Bandwidth: (.*?)/(.*)$|used=$1&total=$2
stream_rule=^\[.*?\]剩余(.*?)@(?:.*)$|total=$1
stream_rule=^.*?流量:(.*?) 剩:(?:.*)$|total=$1
time_rule=^过期时间：(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)$|$1:$2:$3:$4:$5:$6
time_rule=^到期时间(:|：)(\d+)-(\d+)-(\d+)$|$1:$2:$3:0:0:0
time_rule=^Smart Access expire: (\d+)/(\d+)/(\d+)$|$1:$2:$3:0:0:0
time_rule=^.*?时间:(.*?)$|time=$1lkj
